<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .paper { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .has-poster { background-color: #e8f5e9; }
        .no-poster { background-color: #ffebee; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Direct API Test</h1>
    <button onclick="testSearch()">Test Search</button>
    <div id="output"></div>

    <script>
        async function testSearch() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Loading...</p>';
            
            try {
                const response = await fetch('http://localhost:8000/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        query: "Static Regret Constraint Violation",
                        limit: 3
                    })
                });
                
                const papers = await response.json();
                
                let html = `<h2>Received ${papers.length} papers:</h2>`;
                
                papers.forEach((paper, i) => {
                    const hasPoster = paper.poster_position && paper.poster_position.trim();
                    const className = hasPoster ? 'has-poster' : 'no-poster';
                    
                    html += `
                        <div class="paper ${className}">
                            <strong>${i + 1}. ${paper.title}</strong><br>
                            <strong>ID:</strong> ${paper.id}<br>
                            <strong>Poster Position:</strong> <code>${paper.poster_position || 'NOT SET'}</code><br>
                            <strong>Has poster_position key:</strong> ${'poster_position' in paper}<br>
                            <strong>All keys:</strong> ${Object.keys(paper).join(', ')}
                        </div>
                    `;
                });
                
                output.innerHTML = html;
            } catch (error) {
                output.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
